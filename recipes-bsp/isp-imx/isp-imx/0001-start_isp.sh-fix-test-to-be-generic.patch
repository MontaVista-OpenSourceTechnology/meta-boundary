From 4a3b72829d4822301a228c1d89933ad330aabbcd Mon Sep 17 00:00:00 2001
From: Gary Bisson <gary.bisson@boundarydevices.com>
Date: Mon, 14 Dec 2020 14:26:01 +0100
Subject: [PATCH] start_isp.sh: fix test to be generic

So that it works on EVK and any other i.MX 8M Plus platform.

Signed-off-by: Gary Bisson <gary.bisson@boundarydevices.com>
---
 opt/imx8-isp/bin/start_isp.sh | 14 +++++---------
 1 file changed, 5 insertions(+), 9 deletions(-)

diff --git a/opt/imx8-isp/bin/start_isp.sh b/opt/imx8-isp/bin/start_isp.sh
index 559355f..302b6bf 100755
--- a/opt/imx8-isp/bin/start_isp.sh
+++ b/opt/imx8-isp/bin/start_isp.sh
@@ -4,22 +4,18 @@
 #
 
 RUNTIME_DIR="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
-DEVICE_TREE_BASLER="/sys/firmware/devicetree/base/soc@0/bus@30800000/i2c@30a30000/basler_camera@36"
-
+BASLER=`dmesg | grep Basler`
 
 # check if the basler device has been enabled in the device tree
-if [ -d "$DEVICE_TREE_BASLER" ]; then
-
+if [ ! -z "$BASLER" ]; then
 	echo "Starting isp_media_server for Basler daA3840-30mc"
-
 	cd $RUNTIME_DIR
 	# TODO: remove format below, when proper format interface is present in isp media control
 	# uncomment corresponding line to enable 1080p60 ("-c basler_1080p60") or 4kp30 ("-c basler_4k")
-	#exec ./run.sh -c basler_4k -lm
-	exec ./run.sh -c basler_1080p60 -lm
-
+	#exec ./run.sh -c basler_4k
+	exec ./run.sh -c basler_1080p60
 else
 	# no device tree found exit with code no device or address
-	echo "No device tree found for Basler, check dtb file!" >&2
+	echo "Basler camera not found!" >&2
 	exit 6
 fi
-- 
2.29.2

